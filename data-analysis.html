<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Intelligence Data Analyst ‚Äì Demo</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
body{margin:0;font-family:sans-serif;background:#0b0f14;color:#eee;display:flex;flex-direction:column;height:100vh}
header{padding:10px;background:#111827;color:#fff;font-weight:bold}
.layout{flex:1;display:grid;grid-template-columns:320px 1fr}
aside{background:#0f172a;border-right:1px solid #1f2937;overflow:auto;padding:10px}
main{display:grid;grid-template-rows:1fr 260px}
#map{height:100%;width:100%}
.cards{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;background:#111827;padding:10px}
.card{background:#1e293b;padding:10px;border-radius:8px}
label{display:block;margin-top:6px;font-size:12px}
input,textarea,select{width:100%;padding:6px;background:#0b1020;border:1px solid #202a3a;color:#eee;border-radius:6px}
.threat{margin:5px 0}
.list .item{background:#1e293b;padding:8px;margin:6px 0;border-radius:6px;cursor:pointer}
.risk-low{color:#22c55e}.risk-med{color:#f59e0b}.risk-high{color:#ef4444}
</style>
</head>
<body>
<header>üõ∞Ô∏è Intelligence Data Analyst ‚Ä¢ Demo</header>
<div class="layout">
<aside>
<h3>Add / Update Location</h3>
<form id="locationForm">
<label>Name <input id="name" required></label>
<label>Latitude <input id="lat" type="number" step="any" required></label>
<label>Longitude <input id="lng" type="number" step="any" required></label>
<div class="threat">
<label>Crime <input type="range" id="crime" min="0" max="10" value="0"></label>
</div>
<div class="threat">
<label>Terrorism <input type="range" id="terror" min="0" max="10" value="0"></label>
</div>
<div class="threat">
<label>Cyber <input type="range" id="cyber" min="0" max="10" value="0"></label>
</div>
<button type="submit">Add / Update</button>
</form>
<h3>Locations</h3>
<div class="list" id="locationList"></div>
</aside>
<main>
<div id="map"></div>
<div class="cards">
<div class="card"><h4>Threat Breakdown</h4><canvas id="pieChart"></canvas></div>
<div class="card"><h4>Total Locations</h4><div id="totalCount">0</div></div>
<div class="card"><h4>High Risk</h4><div id="highCount">0</div></div>
</div>
</main>
</div>

<script>
let map = L.map('map').setView([20,0],2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'¬© OpenStreetMap'
}).addTo(map);

let locations=[];
let markers={};
let pieChart=new Chart(document.getElementById('pieChart'),{
 type:'pie',
 data:{labels:['Crime','Terrorism','Cyber'],datasets:[{data:[0,0,0],backgroundColor:['#ef4444','#f59e0b','#3b82f6']}]},
 options:{plugins:{legend:{labels:{color:'#eee'}}}}
});

function riskLevel(score){
 if(score<10) return 'low';
 if(score<20) return 'med';
 return 'high';
}

function updateUI(){
 document.getElementById('locationList').innerHTML='';
 let totals=[0,0,0];
 let high=0;
 locations.forEach(loc=>{
   totals[0]+=loc.crime;
   totals[1]+=loc.terror;
   totals[2]+=loc.cyber;
   if(loc.score>=20) high++;
   let div=document.createElement('div');
   div.className='item risk-'+riskLevel(loc.score);
   div.textContent=`${loc.name} (Risk ${loc.score})`;
   div.onclick=()=>map.setView([loc.lat,loc.lng],8);
   document.getElementById('locationList').appendChild(div);
 });
 pieChart.data.datasets[0].data=totals;
 pieChart.update();
 document.getElementById('totalCount').textContent=locations.length;
 document.getElementById('highCount').textContent=high;
}

document.getElementById('locationForm').onsubmit=e=>{
 e.preventDefault();
 let loc={
   name:document.getElementById('name').value,
   lat:+document.getElementById('lat').value,
   lng:+document.getElementById('lng').value,
   crime:+document.getElementById('crime').value,
   terror:+document.getElementById('terror').value,
   cyber:+document.getElementById('cyber').value
 };
 loc.score=loc.crime+loc.terror+loc.cyber;
 locations.push(loc);
 if(markers[loc.name]) map.removeLayer(markers[loc.name]);
 markers[loc.name]=L.marker([loc.lat,loc.lng]).addTo(map).bindPopup(`<b>${loc.name}</b><br>Risk: ${loc.score}`);
 updateUI();
 e.target.reset();
};
</script>
</body>
</html>
